matrix:
  include:
    - language: python
      python: 3.6
      env:
        - FLASK_APP=autoapp.py
        - FLASK_CONFIG=dev.cfg
        - FLASK_DEBUG=0
        - SAUCE_USERNAME="glsorre"
        - SAUCE_ACCESS_KEY="4c0304aa-bba2-4bb2-959b-e4b05459bda2"
        - PORT=8081
      addons:
        sauce_connect:
          username: "glsorre"
          access_key: "4c0304aa-bba2-4bb2-959b-e4b05459bda2"
      before_install:
        - source $HOME/.nvm/nvm.sh
        - nvm install stable
        - nvm use stable
        - cd neaps-api/
        - echo "@@@ Installing API requirements @@@"
        - pip install -r requirements.txt
        - flask run >/dev/null 2>&1 &
        - cd ../neaps-spa/
      install:
        - echo "@@@ Installing SPA requirements @@@"
        - npm install
      script:
        - echo "@@@ Launching SPA tests @@@"
        - npm run unit
        - npm run travisci
    
    - language: python
      python: 3.6
      env:
        - FLASK_APP=autoapp.py
        - FLASK_CONFIG=dev.cfg
        - FLASK_DEBUG=1
      before_install:
        - cd neaps-api/
      install:
        - echo "@@@ Installing API requirements @@@"
        - pip install -r requirements.txt
        - pip install nose
      script:
        - echo "@@@ Running API tests @@@"
        - nosetests
